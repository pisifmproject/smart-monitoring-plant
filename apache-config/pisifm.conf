# PISIFM Apache Configuration
# Copy file ini ke: C:\MyServer\Apache24\conf\extra\pisifm.conf
# Lalu tambahkan di C:\MyServer\Apache24\conf\httpd.conf: Include conf/extra/pisifm.conf

<VirtualHost _default_:80>
    ServerName localhost
    ServerAlias pisifm.local 10.125.48.102 172.20.10.6 127.0.0.1

    # Proxy Configuration - MUST BE BEFORE DocumentRoot
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Proxy API and WebSocket - Order matters!
    ProxyPass /socket.io http://localhost:2000/socket.io
    ProxyPassReverse /socket.io http://localhost:2000/socket.io
    
    ProxyPass /api http://localhost:2000/api
    ProxyPassReverse /api http://localhost:2000/api

    # WebSocket upgrade for Socket.IO
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /socket.io/(.*) ws://localhost:2000/socket.io/$1 [P,L]

    # Frontend Static Files
    DocumentRoot "C:/Users/netcom/Documents/ifm_septian/project/PISIFM/pisifmfe/frontend/dist"

    <Directory "C:/Users/netcom/Documents/ifm_septian/project/PISIFM/pisifmfe/frontend/dist">
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted

        # Vue Router (History Mode) - Redirect all to index.html
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} !^/api
        RewriteCond %{REQUEST_URI} !^/socket\.io
        RewriteRule . /index.html [L]
    </Directory>    # Logging
    ErrorLog "logs/pisifm-error.log"
    CustomLog "logs/pisifm-access.log" common
</VirtualHost>
