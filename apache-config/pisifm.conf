# PISIFM Apache Configuration
# Copy file ini ke: C:\Apache24\conf\extra\pisifm.conf
# Lalu tambahkan di C:\Apache24\conf\httpd.conf: Include conf/extra/pisifm.conf

<VirtualHost *:80>
    ServerName pisifm.local
    ServerAlias localhost
    
    # Frontend Static Files
    DocumentRoot "C:/Users/netcom/Documents/ifm_septian/project/PISIFM/pisifmfe/frontend/dist"
    
    <Directory "C:/Users/netcom/Documents/ifm_septian/project/PISIFM/pisifmfe/frontend/dist">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Vue Router (History Mode) - Redirect all to index.html
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteRule ^index\.html$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.html [L]
        </IfModule>
    </Directory>
    
    # Proxy API requests to Backend (Port 2000)
    ProxyPreserveHost On
    ProxyPass /api http://localhost:2000/api
    ProxyPassReverse /api http://localhost:2000/api
    
    # WebSocket Support (Socket.IO)
    ProxyPass /socket.io http://localhost:2000/socket.io
    ProxyPassReverse /socket.io http://localhost:2000/socket.io
    
    # Enable WebSocket upgrade for Socket.IO
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:2000/$1" [P,L]
    
    # Logging
    ErrorLog "logs/pisifm-error.log"
    CustomLog "logs/pisifm-access.log" common
</VirtualHost>
